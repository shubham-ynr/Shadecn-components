{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "data-table",
  "title": "Data Table",
  "description": "A dynamic, server-side paginated data table with search, sorting, selection, and loading states.",
  "dependencies": [
    "lucide-react"
  ],
  "registryDependencies": [
    "table",
    "select",
    "checkbox",
    "button"
  ],
  "files": [
    {
      "path": "registry/new-york/blocks/data-table/data-table.jsx",
      "content": "import { useState, useCallback, useEffect, useRef } from \"react\";\nimport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableRow,\n  TableHead,\n  TableCell,\n} from \"@/components/ui/table\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport {\n  ChevronLeftIcon,\n  ChevronRightIcon,\n  ChevronsLeftIcon,\n  ChevronsRightIcon,\n  ArrowUpDown,\n  ArrowUp,\n  ArrowDown,\n  Search,\n  Loader2,\n} from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\n\n/**\n * Dynamic DataTable component.\n *\n * @param {Object} props\n * @param {(params: object) => Promise<any>} props.fetcher - Function that calls the API with {page, per_page, search, sort_by, sort_order}\n * @param {Array} props.columns - Column definitions\n * @param {boolean} [props.searchable=true]\n * @param {boolean} [props.selectable=false]\n * @param {string} [props.searchPlaceholder=\"Search...\"]\n * @param {number[]} [props.perPageOptions=[10,15,25,50,100]]\n * @param {(selected: Array) => void} [props.onSelectionChange]\n * @param {React.ReactNode} [props.rightItems]\n * @param {React.ReactNode} [props.selectableContent]\n */\nexport default function DataTable({\n  fetcher,\n  columns = [],\n  searchable = true,\n  selectable = false,\n  searchPlaceholder = \"Search...\",\n  perPageOptions = [10, 15, 25, 50, 100],\n  onSelectionChange,\n  rightItems,\n  selectableContent,\n}) {\n  // --- State Management ---\n  const [data, setData] = useState([]);\n  const [pagination, setPagination] = useState(null);\n  const [loading, setLoading] = useState(false);\n\n  // Query States (These trigger API calls)\n  const [search, setSearch] = useState(\"\");\n  const [sortKey, setSortKey] = useState(null);\n  const [sortOrder, setSortOrder] = useState(\"asc\");\n  const [perPage, setPerPage] = useState(perPageOptions[0]);\n  const [currentPage, setCurrentPage] = useState(1);\n\n  const [selected, setSelected] = useState([]);\n  const searchTimeout = useRef(null);\n\n  // --- Core Data Fetcher ---\n  const fetchData = useCallback(\n    async (overrideParams = {}) => {\n      if (!fetcher) return;\n\n      setLoading(true);\n      try {\n        // Construct parameters to send to the API\n        const queryParams = {\n          page: overrideParams.page ?? currentPage,\n          per_page: overrideParams.per_page ?? perPage,\n          search: overrideParams.search ?? search,\n          sort_by: overrideParams.sort_by ?? sortKey,\n          sort_order: overrideParams.sort_order ?? sortOrder,\n        };\n\n        const response = await fetcher(queryParams);\n\n        // Assuming standard pagination structure: { data: [], current_page: 1, last_page: 5, total: 50 }\n        setData(response?.data ?? []);\n        setPagination(response);\n\n        // Reset selection on new data fetch if needed\n        setSelected([]);\n        onSelectionChange?.([]);\n      } catch (error) {\n        console.error(\"DataTable fetch error:\", error);\n      } finally {\n        setLoading(false);\n      }\n    },\n    [\n      fetcher,\n      currentPage,\n      perPage,\n      search,\n      sortKey,\n      sortOrder,\n      onSelectionChange,\n    ],\n  );\n\n  // Re-fetch when pagination or sorting changes\n  useEffect(() => {\n    fetchData();\n  }, [currentPage, perPage, sortKey, sortOrder]);\n\n  // --- Event Handlers ---\n  const handleSearch = (value) => {\n    setSearch(value);\n    setCurrentPage(1); // Always reset to page 1 on search\n\n    if (searchTimeout.current) clearTimeout(searchTimeout.current);\n\n    searchTimeout.current = setTimeout(() => {\n      // Trigger API call specifically with the new search value\n      fetchData({ search: value, page: 1 });\n    }, 500);\n  };\n\n  const handleSort = (key) => {\n    const newOrder = sortKey === key && sortOrder === \"asc\" ? \"desc\" : \"asc\";\n    setSortKey(key);\n    setSortOrder(newOrder);\n    setCurrentPage(1);\n  };\n\n  const handlePageChange = (page) => {\n    setCurrentPage(page);\n  };\n\n  const handlePerPageChange = (value) => {\n    setPerPage(parseInt(value));\n    setCurrentPage(1);\n  };\n\n  // --- Selection Logic ---\n  const allSelected = data.length > 0 && selected.length === data.length;\n  const someSelected = selected.length > 0 && selected.length < data.length;\n\n  const toggleAll = () => {\n    const next = allSelected ? [] : data.map((_, i) => i);\n    setSelected(next);\n    onSelectionChange?.(allSelected ? [] : data);\n  };\n\n  const toggleRow = (index) => {\n    const next = selected.includes(index)\n      ? selected.filter((i) => i !== index)\n      : [...selected, index];\n    setSelected(next);\n    onSelectionChange?.(next.map((i) => data[i]));\n  };\n\n  // --- Sub-components ---\n  const SortIcon = ({ colKey }) => {\n    if (sortKey !== colKey)\n      return <ArrowUpDown className=\"size-3.5 opacity-40\" />;\n    return sortOrder === \"asc\" ? (\n      <ArrowUp className=\"size-3.5\" />\n    ) : (\n      <ArrowDown className=\"size-3.5\" />\n    );\n  };\n\n  // Pagination Helpers\n  const page = pagination?.current_page ?? 1;\n  const lastPage = pagination?.last_page ?? 1;\n  const total = pagination?.total ?? 0;\n  const from = pagination?.from ?? 0;\n  const to = pagination?.to ?? 0;\n\n  return (\n    <div className=\"w-full space-y-4\">\n      {/* Header: search + perPage */}\n      <div className=\"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between\">\n        <div className=\"flex items-center gap-3 flex-1 min-w-0\">\n          {searchable && (\n            <div className=\"relative w-full max-w-xs\">\n              <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 size-4 text-muted-foreground\" />\n              <input\n                type=\"text\"\n                className=\"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 pl-9 text-sm shadow-sm transition-colors placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring\"\n                placeholder={searchPlaceholder}\n                value={search}\n                onChange={(e) => handleSearch(e.target.value)}\n              />\n            </div>\n          )}\n          <Select value={String(perPage)} onValueChange={handlePerPageChange}>\n            <SelectTrigger className=\"h-9 w-[70px]\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              {perPageOptions.map((opt) => (\n                <SelectItem key={opt} value={String(opt)}>\n                  {opt}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        </div>\n        {rightItems && (\n          <div className=\"flex items-center gap-2 shrink-0\">{rightItems}</div>\n        )}\n      </div>\n\n      {/* Table Container */}\n      <div className=\"rounded-lg border overflow-hidden relative\">\n        {selected.length > 0 && selectableContent && (\n          <div className=\"bg-muted/30 border-b p-2 flex items-center\">\n            {selectableContent}\n          </div>\n        )}\n\n        {/* Loading Bar Overlay */}\n        {loading && (\n          <div className=\"absolute top-0 left-0 right-0 h-[2px] z-10 overflow-hidden\">\n            <style>{`\n              @keyframes progress-bar-1 {\n                0% { left: -100%; right: 100%; }\n                60% { left: 100%; right: -90%; }\n                100% { left: 100%; right: -90%; }\n              }\n              @keyframes progress-bar-2 {\n                0% { left: -136%; right: 100%; }\n                60% { left: 100%; right: -30%; }\n                100% { left: 100%; right: -30%; }\n              }\n              .animate-progress-bar-1 {\n                position: absolute; top: 0; bottom: 0; will-change: left, right;\n                animation: progress-bar-1 2.1s cubic-bezier(0.65, 0.815, 0.735, 0.395) infinite;\n              }\n              .animate-progress-bar-2 {\n                position: absolute; top: 0; bottom: 0; will-change: left, right;\n                animation: progress-bar-2 2.1s cubic-bezier(0.165, 0.84, 0.44, 1) 1.15s infinite;\n              }\n            `}</style>\n            <div className=\"bg-primary animate-progress-bar-1\" />\n            <div className=\"bg-primary animate-progress-bar-2\" />\n          </div>\n        )}\n\n        <Table>\n          <TableHeader>\n            <TableRow className=\"bg-muted/50 hover:bg-muted/50\">\n              {selectable && (\n                <TableHead className=\"w-12\">\n                  <Checkbox\n                    checked={allSelected}\n                    indeterminate={someSelected}\n                    onCheckedChange={toggleAll}\n                  />\n                </TableHead>\n              )}\n              {columns.map((col) => (\n                <TableHead key={col.key}>\n                  {col.sortable !== false ? (\n                    <button\n                      type=\"button\"\n                      className=\"inline-flex items-center gap-1.5 hover:text-foreground transition-colors\"\n                      onClick={() => handleSort(col.key)}\n                    >\n                      {col.head}\n                      <SortIcon colKey={col.key} />\n                    </button>\n                  ) : (\n                    col.head\n                  )}\n                </TableHead>\n              ))}\n            </TableRow>\n          </TableHeader>\n          <TableBody>\n            {data.length === 0 ? (\n              <TableRow>\n                <TableCell\n                  colSpan={columns.length + (selectable ? 1 : 0)}\n                  className=\"h-[400px] text-center\"\n                >\n                  {loading ? (\n                    <div className=\"flex flex-col items-center justify-center gap-3\">\n                      <Loader2 className=\"size-8 text-primary animate-spin\" />\n                      <p className=\"text-sm text-muted-foreground\">\n                        Fetching data...\n                      </p>\n                    </div>\n                  ) : (\n                    <p className=\"text-muted-foreground\">No records found.</p>\n                  )}\n                </TableCell>\n              </TableRow>\n            ) : (\n              data.map((row, idx) => (\n                <TableRow\n                  key={row.id ?? idx}\n                  data-state={selected.includes(idx) ? \"selected\" : undefined}\n                >\n                  {selectable && (\n                    <TableCell>\n                      <Checkbox\n                        checked={selected.includes(idx)}\n                        onCheckedChange={() => toggleRow(idx)}\n                      />\n                    </TableCell>\n                  )}\n                  {columns.map((col) => (\n                    <TableCell key={col.key}>\n                      {col.render\n                        ? col.render(row[col.key], row)\n                        : (row[col.key] ?? \"â€”\")}\n                    </TableCell>\n                  ))}\n                </TableRow>\n              ))\n            )}\n          </TableBody>\n        </Table>\n      </div>\n\n      {/* Footer: per-page selector + pagination */}\n      <div className=\"flex flex-col gap-3 sm:flex-row sm:items-center justify-end\">\n        <div className=\"flex items-center gap-2\">\n          <span className=\"text-sm text-muted-foreground whitespace-nowrap select-none\">\n            {from}-{to} of {total}\n          </span>\n          <div className=\"flex items-center gap-1\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              className=\"size-8\"\n              disabled={page <= 1}\n              onClick={() => handlePageChange(1)}\n            >\n              <ChevronsLeftIcon className=\"size-4\" />\n            </Button>\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              className=\"size-8\"\n              disabled={page <= 1}\n              onClick={() => handlePageChange(page - 1)}\n            >\n              <ChevronLeftIcon className=\"size-4\" />\n            </Button>\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              className=\"size-8\"\n              disabled={page >= lastPage}\n              onClick={() => handlePageChange(page + 1)}\n            >\n              <ChevronRightIcon className=\"size-4\" />\n            </Button>\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              className=\"size-8\"\n              disabled={page >= lastPage}\n              onClick={() => handlePageChange(lastPage)}\n            >\n              <ChevronsRightIcon className=\"size-4\" />\n            </Button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n",
      "type": "registry:component"
    }
  ],
  "type": "registry:component"
}